<!DOCTYPE html>
<html lang="en">
<head>

    <title>Build a Decision Tree by Hand with TensorFlow Decision Forest</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preload" as="style" href="../assets/built/screen.css%3Fv=9b52753ec9.css">
    <link rel="preload" as="script" href="../assets/built/source.js%3Fv=9b52753ec9">
    
    <link rel="preload" as="font" type="font/woff2" href="../assets/fonts/inter-roman.woff2%3Fv=9b52753ec9" crossorigin="anonymous">
<style>
    @font-face {
        font-family: "Inter";
        font-style: normal;
        font-weight: 100 900;
        font-display: optional;
        src: url(../assets/fonts/inter-roman.woff2%3Fv=9b52753ec9) format("woff2");
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
</style>

    <link rel="stylesheet" type="text/css" href="../assets/built/screen.css%3Fv=9b52753ec9.css">

    <style>
        :root {
            --background-color: #ffffff
        }
    </style>

    <script>
        /* The script for calculating the color contrast has been taken from
        https://gomakethings.com/dynamically-changing-the-text-color-based-on-background-color-contrast-with-vanilla-js/ */
        var accentColor = getComputedStyle(document.documentElement).getPropertyValue('--background-color');
        accentColor = accentColor.trim().slice(1);

        if (accentColor.length === 3) {
            accentColor = accentColor[0] + accentColor[0] + accentColor[1] + accentColor[1] + accentColor[2] + accentColor[2];
        }

        var r = parseInt(accentColor.substr(0, 2), 16);
        var g = parseInt(accentColor.substr(2, 2), 16);
        var b = parseInt(accentColor.substr(4, 2), 16);
        var yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
        var textColor = (yiq >= 128) ? 'dark' : 'light';

        document.documentElement.className = `has-${textColor}-text`;
    </script>

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Spacecraft">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Build a Decision Tree by Hand with TensorFlow Decision Forest">
    <meta property="og:description" content="1 Problem Statement

In the real business world, business strategies are mostly generated by decision trees, but the native rules of a decision tree have some issues:

 * Some features might lead to legal/compliance controversy or customer complaints
 * The threshold of split features lack readability, such as 0.1483329203

In">
    <meta property="og:url" content="https://realvincentyuan.github.io/Spacecraft/build-a-decision-tree-by-hand-with-tensorflow/">
    <meta property="og:image" content="https://realvincentyuan.github.io/Spacecraft/content/images/2023/07/TF_FullColor_Stacked-7.png">
    <meta property="article:published_time" content="2023-07-23T21:23:00.000Z">
    <meta property="article:modified_time" content="2023-10-22T21:30:46.000Z">
    <meta property="article:tag" content="Tech">
    <meta property="article:tag" content="AI">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="TensorFlow">
    
    <meta property="article:publisher" content="https://www.facebook.com/ghost">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Build a Decision Tree by Hand with TensorFlow Decision Forest">
    <meta name="twitter:description" content="1 Problem Statement

In the real business world, business strategies are mostly generated by decision trees, but the native rules of a decision tree have some issues:

 * Some features might lead to legal/compliance controversy or customer complaints
 * The threshold of split features lack readability, such as 0.1483329203

In">
    <meta name="twitter:url" content="https://realvincentyuan.github.io/Spacecraft/build-a-decision-tree-by-hand-with-tensorflow/">
    <meta name="twitter:image" content="https://realvincentyuan.github.io/Spacecraft/content/images/2023/07/TF_FullColor_Stacked-7.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Vincent Yuan">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="Tech, AI, Python, TensorFlow">
    <meta name="twitter:site" content="@ghost">
    <meta name="twitter:creator" content="@RealVincentYuan">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Spacecraft",
        "url": "https://realvincentyuan.github.io/Spacecraft/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://realvincentyuan.github.io/Spacecraft/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Vincent Yuan",
        "image": {
            "@type": "ImageObject",
            "url": "https://realvincentyuan.github.io/Spacecraft/content/images/2024/07/avatar-1.png",
            "width": 752,
            "height": 752
        },
        "url": "https://realvincentyuan.github.io/Spacecraft/author/vincent-2/",
        "sameAs": [
            "https://unsplash.com/@vincentyuan87",
            "https://twitter.com/RealVincentYuan"
        ]
    },
    "headline": "Build a Decision Tree by Hand with TensorFlow Decision Forest",
    "url": "https://realvincentyuan.github.io/Spacecraft/build-a-decision-tree-by-hand-with-tensorflow/",
    "datePublished": "2023-07-23T21:23:00.000Z",
    "dateModified": "2023-10-22T21:30:46.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://realvincentyuan.github.io/Spacecraft/content/images/2023/07/TF_FullColor_Stacked-7.png"
    },
    "keywords": "Tech, AI, Python, TensorFlow",
    "description": "1 Problem Statement\n\nIn the real business world, business strategies are mostly generated by decision trees, but the native rules of a decision tree have some issues:\n\n * Some features might lead to legal/compliance controversy or customer complaints\n * The threshold of split features lack readability, such as 0.1483329203\n\nIn order to address these 2 issues, data scientists need to manually tweak nodes in a decision tree in order to meet business requirements, normally this process is done with",
    "mainEntityOfPage": "https://realvincentyuan.github.io/Spacecraft/build-a-decision-tree-by-hand-with-tensorflow/"
}
    </script>

    <meta name="generator" content="Ghost 5.87">
    <link rel="alternate" type="application/rss+xml" title="Spacecraft" href="../rss/index.html">
    <script defer src="https://cdn.jsdelivr.net/ghost/portal@~2.37/umd/portal.min.js" data-i18n="false" data-ghost="https://realvincentyuan.github.io/Spacecraft/" data-key="59658b4dc0364cacbc3332171d" data-api="https://realvincentyuan.github.io/Spacecraft/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="59658b4dc0364cacbc3332171d" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://realvincentyuan.github.io/Spacecraft/" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/ghost/announcement-bar@~1.1/umd/announcement-bar.min.js" data-announcement-bar="https://realvincentyuan.github.io/Spacecraft/" data-api-url="https://realvincentyuan.github.io/Spacecraft/members/api/announcement/" crossorigin="anonymous"></script>
    <link href="https://realvincentyuan.github.io/Spacecraft/webmentions/receive/" rel="webmention">
    <script defer src="../public/cards.min.js%3Fv=9b52753ec9"></script>
    <link rel="stylesheet" type="text/css" href="../public/cards.min.css%3Fv=9b52753ec9.css">
    <script defer src="../public/comment-counts.min.js%3Fv=9b52753ec9" data-ghost-comments-counts-api="https://realvincentyuan.github.io/Spacecraft/members/api/comments/counts/"></script>
    <script defer src="../public/member-attribution.min.js%3Fv=9b52753ec9"></script><style>:root {--ghost-accent-color: #0f69c2;}</style>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-633EG809GP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-633EG809GP');
</script>

<!-- Reading progress bar -->
<style>
.reading-progress {
  position: fixed;
  top: 0;
  z-index: 999;
  width: 100%;
  height: 5px; /* Progress bar height */
  background: #c5d2d9; /* Progress bar background color */
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none; /* Hide default progress bar */
}

.reading-progress::-webkit-progress-bar {
  background-color: transparent;
}

.reading-progress::-webkit-progress-value {
  background: var(--ghost-accent-color); /* Progress bar color */
}
</style>


<!--   Scroll Top Button  -->
<style>
    /*Scroll to Top CSS*/
    .scroll-top {
		position: fixed;
 		z-index: 50;
		padding: 0;
		right: 30px;
		bottom: 100px;
		opacity: 0;
		visibility: hidden;
		transform: translateY(15px);    
		height: 46px;
		width: 46px;
		cursor: pointer;
		display: flex;
  		align-items: center;
  		justify-content: center;
		border-radius: 50%;
  	transition: all .4s ease;
  	border: none;
  	box-shadow: inset 0 0 0 2px #ccc;
  	color: #ccc;
  	background-color: #fff;
	}

	.scroll-top.is-active {
		opacity: 1;
  		visibility: visible;
  		transform: translateY(0);
	}

	.scroll-top .icon-tabler-arrow-up {
  		position: absolute;
  		stroke-width: 2px;
  		stroke: #333;
	}

	.scroll-top svg path { 
		fill: none; 
	}

	.scroll-top svg.progress-circle path {
		stroke: #333;
		stroke-width: 4;
  		transition: all .4s ease;
	}

	.scroll-top:hover {
  		color: var(--ghost-accent-color);
	}

	.scroll-top:hover .progress-circle path, .scroll-top:hover .icon-tabler-arrow-up {
  		stroke: var(--ghost-accent-color);
	}
          
</style>

    <button class="btn-toggle-round scroll-top js-scroll-top" type="button" title="Scroll to top">
      <svg class="progress-circle" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
      </svg>
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="cuurentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <line x1="12" y1="5" x2="12" y2="19" />
        <line x1="18" y1="11" x2="12" y2="5" />
        <line x1="6" y1="11" x2="12" y2="5" />
      </svg>
    </button>



<!-- Code highlights -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>
<body class="post-template tag-tech tag-ai tag-python tag-tensorflow tag-hash-import-2024-07-07-04-35 has-sans-title has-sans-body">

<div class="gh-viewport">
    
    <header id="gh-navigation" class="gh-navigation is-middle-logo gh-outer">
    <div class="gh-navigation-inner gh-inner">

        <div class="gh-navigation-brand">
            <a class="gh-navigation-logo is-title" href="../index.html">
                    Spacecraft
            </a>
            <button class="gh-search gh-icon-button" aria-label="Search this site" data-ghost-search>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>            <button class="gh-burger gh-icon-button" aria-label="Menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128ZM40,72H216a8,8,0,0,0,0-16H40a8,8,0,0,0,0,16ZM216,184H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg>                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg>            </button>
        </div>

        <nav class="gh-navigation-menu">
            <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-tech"><a href="../tag/tech/index.html">Tech</a></li>
    <li class="nav-profession"><a href="../tag/pro/index.html">Profession</a></li>
    <li class="nav-life"><a href="../tag/life/index.html">Life</a></li>
    <li class="nav-about"><a href="../about/index.html">About</a></li>
</ul>

        </nav>

        <div class="gh-navigation-actions">
                <button class="gh-search gh-icon-button" aria-label="Search this site" data-ghost-search>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>                <div class="gh-navigation-members">
                            <a href="index.html#/portal/signin" data-portal="signin">Sign in</a>
                                <a class="gh-button" href="index.html#/portal/signup" data-portal="signup">Subscribe</a>
                </div>
        </div>

    </div>
</header>

    

<main class="gh-main">

    <article class="gh-article post tag-tech tag-ai tag-python tag-tensorflow tag-hash-import-2024-07-07-04-35 featured">

        <header class="gh-article-header gh-canvas">

                <a class="gh-article-tag" href="../tag/tech/index.html">Tech</a>
            <h1 class="gh-article-title is-title">Build a Decision Tree by Hand with TensorFlow Decision Forest</h1>

            <div class="gh-article-meta">
                <div class="gh-article-author-image instapaper_ignore">
                            <a href="../author/vincent-2/index.html">
                                <img class="author-profile-image" src="../content/images/size/w160/2024/07/avatar-1.png" alt="Vincent Yuan">
                            </a>
                </div>
                <div class="gh-article-meta-wrapper">
                    <h4 class="gh-article-author-name"><a href="../author/vincent-2/index.html">Vincent Yuan</a></h4>
                    <div class="gh-article-meta-content">
                        <time class="gh-article-meta-date" datetime="2023-07-23">Jul 23, 2023</time>
                            <span class="gh-article-meta-length"><span class="bull">â€”</span> 10 min read</span>
                    </div>
                </div>
            </div>

                <figure class="gh-article-image">
        <picture>
            <source srcset="../content/images/size/w2000/2023/07/TF_FullColor_Stacked-7.png" media="(min-width: 2000px)">
            <source srcset="../content/images/size/w1200/2023/07/TF_FullColor_Stacked-7.png" media="(min-width: 1200px)">
            <source srcset="../content/images/size/w960/2023/07/TF_FullColor_Stacked-7.png" media="(min-width: 960px)">
            <source srcset="../content/images/size/w600/2023/07/TF_FullColor_Stacked-7.png" media="(min-width: 600px)">
            <source srcset="../content/images/size/w320/2023/07/TF_FullColor_Stacked-7.png" media="(min-width: 320px)">
            <img src="https://realvincentyuan.github.io/Spacecraft/content/images/size/w1200/2023/07/TF_FullColor_Stacked-7.png" alt="Build a Decision Tree by Hand with TensorFlow Decision Forest">
        </picture>
    </figure>

        </header>

        <section class="gh-content gh-canvas is-body">
            <h2 id="1-problem-statement">1 Problem Statement</h2><p>In the real business world, business strategies are mostly generated by decision trees, but the native rules of a decision tree have some issues:</p><ul><li>Some features might lead to legal/compliance controversy or customer complaints</li><li>The threshold of split features lack readability, such as 0.1483329203</li></ul><p>In order to address these 2 issues, data scientists need to manually tweak nodes in a decision tree in order to meet business requirements, normally this process is done with commercial softwares as they provide flexibility for tree fine-tuning. But now, this can be done with TensorFlow Decision Forest in Python!</p><p>In this post, a way to build decision tree by hand with <code>TensorFlow Decision Forest</code> is shared so that data scientists can fusion the expertise with the native machine learning model to address business needs.</p><p>This is the summary of each step in this workflow:</p><ul><li>Build a native machine model</li><li>Fine tune nodes to build a fusion tree</li><li>Reset the performance of each leaf in the fusion tree</li><li>Build a new model shell containing the fusion tree</li><li>Use the new model to predict on the dataset and get prediction results</li><li>Refresh the fusion tree with the literal performance of each leaf node</li></ul><p>A public dataset for penguins species prediction is used in this post and the code has been tested in <code>Google Colab</code> as of July 2023. </p><h2 id="2-workflow">2 Workflow</h2><h3 id="21-prepare-dataset">2.1 Prepare Dataset</h3><p>Firstly, let's import some packages, note that the version of <code>tensorflow_decision_forests</code> is <code>1.5.0</code>, make sure your TensorFlow is also compatible.</p><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">ðŸ’¡</div><div class="kg-callout-text">Check the compatibility of tensorflow_decision_forests and TensorFlow in this <a href="https://github.com/tensorflow/decision-forests/blob/main/documentation/known_issues.md?ref=localhost#compatibility-table">compatibility table</a>.</div></div><pre><code class="language-py">import tensorflow_decision_forests as tfdf

import os
import numpy as np
import pandas as pd
import tensorflow as tf
import matplotlib.pyplot as plt
import math
import collections
</code></pre><p>Then let's download the dataset by using the <code>wget</code> command and read it through Pandas:</p><pre><code class="language-py"># Download the dataset
!wget -q https://storage.googleapis.com/download.tensorflow.org/data/palmer_penguins/penguins.csv -O /tmp/penguins.csv

# Load a dataset into a Pandas Dataframe.
dataset_df = pd.read_csv("/tmp/penguins.csv")
</code></pre><p>The data is like this:</p><!--kg-card-begin: html--><table>
<thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right">species</th>
<th style="text-align: right">island</th>
<th style="text-align: right">bill_length_mm</th>
<th style="text-align: right">bill_depth_mm</th>
<th style="text-align: right">flipper_length_mm</th>
<th style="text-align: right">body_mass_g</th>
<th style="text-align: right">sex</th>
<th style="text-align: right">year</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right">0</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">39.1</td>
<td style="text-align: right">18.7</td>
<td style="text-align: right">181.0</td>
<td style="text-align: right">3750.0</td>
<td style="text-align: right">male</td>
<td style="text-align: right">2007</td>
</tr>
<tr>
<td style="text-align: right">1</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">39.5</td>
<td style="text-align: right">17.4</td>
<td style="text-align: right">186.0</td>
<td style="text-align: right">3800.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2007</td>
</tr>
<tr>
<td style="text-align: right">2</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">40.3</td>
<td style="text-align: right">18.0</td>
<td style="text-align: right">195.0</td>
<td style="text-align: right">3250.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2007</td>
</tr>
<tr>
<td style="text-align: right">3</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">2007</td>
</tr>
<tr>
<td style="text-align: right">4</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">36.7</td>
<td style="text-align: right">19.3</td>
<td style="text-align: right">193.0</td>
<td style="text-align: right">3450.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2007</td>
</tr>
<tr>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
</tr>
<tr>
<td style="text-align: right">339</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">55.8</td>
<td style="text-align: right">19.8</td>
<td style="text-align: right">207.0</td>
<td style="text-align: right">4000.0</td>
<td style="text-align: right">male</td>
<td style="text-align: right">2009</td>
</tr>
<tr>
<td style="text-align: right">340</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">43.5</td>
<td style="text-align: right">18.1</td>
<td style="text-align: right">202.0</td>
<td style="text-align: right">3400.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2009</td>
</tr>
<tr>
<td style="text-align: right">341</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">49.6</td>
<td style="text-align: right">18.2</td>
<td style="text-align: right">193.0</td>
<td style="text-align: right">3775.0</td>
<td style="text-align: right">male</td>
<td style="text-align: right">2009</td>
</tr>
<tr>
<td style="text-align: right">342</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">50.8</td>
<td style="text-align: right">19.0</td>
<td style="text-align: right">210.0</td>
<td style="text-align: right">4100.0</td>
<td style="text-align: right">male</td>
<td style="text-align: right">2009</td>
</tr>
<tr>
<td style="text-align: right">343</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">50.2</td>
<td style="text-align: right">18.7</td>
<td style="text-align: right">198.0</td>
<td style="text-align: right">3775.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2009</td>
</tr>
</tbody>
</table><!--kg-card-end: html--><p>Then convert this into a TensorFlow Dataset:</p><pre><code class="language-py"># Convert the pandas dataframe into a tf dataset.
dataset_tf = tfdf.keras.pd_dataframe_to_tf_dataset(dataset_df, label="species")
</code></pre><h3 id="22-train-a-decision-tree">2.2 Train a Decision Tree</h3><pre><code class="language-py"># Train the decicion tree
model = tfdf.keras.CartModel()

model.fit(x=dataset_tf)
</code></pre><p>After training, you can plot the model this way:</p><pre><code class="language-py">tfdf.model_plotter.plot_model_in_colab(model, tree_idx=0, max_depth=5)
</code></pre><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/img/1_V/ml_tree.png" class="kg-image" alt loading="lazy"><figcaption>Native Decision Tree</figcaption></figure><h3 id="23-fine-tune-nodes">2.3 Fine Tune Nodes</h3><p>This step shows how you can tweak some nodes of the tree above, fusion your expertise and customize your model. Firstly let's define some aliases that will be used later.</p><pre><code class="language-py"># Create some aliases
Tree = tfdf.py_tree.tree.Tree
SimpleColumnSpec = tfdf.py_tree.dataspec.SimpleColumnSpec
ColumnType = tfdf.py_tree.dataspec.ColumnType
# Nodes
NonLeafNode = tfdf.py_tree.node.NonLeafNode
LeafNode = tfdf.py_tree.node.LeafNode
# Conditions
NumericalHigherThanCondition = tfdf.py_tree.condition.NumericalHigherThanCondition
CategoricalIsInCondition = tfdf.py_tree.condition.CategoricalIsInCondition
# Leaf values
ProbabilityValue = tfdf.py_tree.value.ProbabilityValue


sample_tree = inspector.extract_tree(tree_idx=0)
print(sample_tree)
</code></pre><p>The output is like below, this is a plain text version of the tree plot above.</p><pre><code class="language-shell">(flipper_length_mm &gt;= 206.5; miss=False, score=0.5436033606529236)
    â”œâ”€(pos)â”€ (bill_depth_mm &gt;= 17.649999618530273; miss=False, score=0.2061920464038849)
    â”‚        â”œâ”€(pos)â”€ ProbabilityValue([0.3333333333333333, 0.6666666666666666, 0.0],n=6.0) (idx=4)
    â”‚        â””â”€(neg)â”€ ProbabilityValue([0.0, 0.0, 1.0],n=108.0) (idx=3)
    â””â”€(neg)â”€ (island in ['Biscoe', 'Torgersen']; miss=True, score=0.23399487137794495)
             â”œâ”€(pos)â”€ ProbabilityValue([0.9767441860465116, 0.0, 0.023255813953488372],n=86.0) (idx=2)
             â””â”€(neg)â”€ (bill_length_mm &gt;= 42.349998474121094; miss=True, score=0.5646106004714966)
                      â”œâ”€(pos)â”€ ProbabilityValue([0.03278688524590164, 0.9672131147540983, 0.0],n=61.0) (idx=1)
                      â””â”€(neg)â”€ ProbabilityValue([0.9795918367346939, 0.02040816326530612, 0.0],n=49.0) (idx=0)
</code></pre><p>Then a node threshold of feature <code>bill_depth_mm</code> is updated to a value with better readability:</p><pre><code class="language-py">sample_tree.root.pos_child.condition = NumericalHigherThanCondition(
                feature=SimpleColumnSpec(name="bill_depth_mm", type=ColumnType.NUMERICAL),
                threshold=17.5,
                missing_evaluation=False)
</code></pre><h3 id="24-tree-traversal">2.4 Tree Traversal</h3><p>Traversal allows us to save each nodes of the tree, which is helpful for updating the tree in later steps, let's define a few traversal functions.</p><pre><code class="language-py">def leaf_reset_util(root, num_classes, scale_div):

    """
    Reset the probability values of each leaf node.

    Parameters
    -----------
      root: root node of a tree.
      num_classes: number of classes.
      scale_div: a numeric scale denominator used to create mutual exclusive probablity of each leaf node.

    Return
    -----------
      A tree structure with reset probability for each leaf node.

    """

    import tensorflow_decision_forests as tfdf

    # Alias
    LeafNode = tfdf.py_tree.node.LeafNode
    ProbabilityValue = tfdf.py_tree.value.ProbabilityValue

    if num_classes &lt; 2:
      raise ValueError("The number of unique classes should be at least 2 i.e."
                       " binary classification.")

    if not isinstance(num_classes, int):
      raise ValueError(f"The number of unique classes must be a integer greater than or equal to 2, got {num_classes}.")

    if root is None:
        return

    if isinstance(root, LeafNode):

        # make a pseudo probablity list based on number of classes
        prob_list = [0 for i in range(num_classes)]
        # assign the probablity of the last class as the leaf index divided by the scale denominator
        prob_list[-1] = root.leaf_idx/scale_div

        root.value = ProbabilityValue(probability=prob_list)
    else:
        leaf_reset_util(root.pos_child, num_classes, scale_div)
        leaf_reset_util(root.neg_child, num_classes, scale_div)

    return


def inoder_traverse(root, mode):

    """
    Traverse the tree using in-order traversal.

    Parameters
    -----------
      root: root node of a tree.
      mode: the type of node to traverse.

    Return
    -----------
      A list of nodes in the tree base on the choice of traversal mode.

    """

    answer = []

    inorder_traversal_util(root, answer, mode)
    return answer

def inorder_traversal_util(root, answer, mode):

    """
    Traverse the tree using in-order traversal.

    Parameters
    -----------
      root: root node of a tree.
      answer: a list placeholder to store the traversal answer.
      mode: the type of node to traverse.

    Return
    -----------
      A list of nodes in the tree base on the choice of traversal mode.

    """


    if mode == 'all':

        if root is None:
            return

        # if this is a leaf node, just return the value, otherwise, continue the traversal
        if isinstance(root, LeafNode):
          answer.append(root.value)
        else:

          inorder_traversal_util(root.pos_child, answer, mode)
          answer.append(root.value)
          inorder_traversal_util(root.neg_child, answer, mode)
        return

    elif mode == 'leaf':

        if root is None:
            return

        # if this is a leaf node, just return the value, otherwise, continue the traversal

        if isinstance(root, LeafNode):
          answer.append([root.value.probability, root.value.num_examples, root.leaf_idx])
        else:

          inorder_traversal_util(root.pos_child, answer, mode)
          inorder_traversal_util(root.neg_child, answer, mode)
        return

    else:
      raise ValueError(f"Use either 'all' or 'leaf' mode to traverse, but got '{mode}', nothing is returned.")
</code></pre><p><strong>Remember that the node of the tree has been modified while the prediction value of each node has not been updated.</strong> Thus, let's firstly reset the prediction value of each node, as a placeholder. This placeholder will be updated with literal performance of each node later.</p><pre><code class="language-py">scale_div = 100
leaf_reset_util(root=sample_tree.root,
                num_classes=3,
                scale_div=scale_div)
</code></pre><h3 id="25-tree-builder">2.5 Tree Builder</h3><p>In this step, the <a href="https://www.tensorflow.org/decision_forests/api_docs/python/tfdf/builder?ref=localhost">tree builder</a> in TensorFlow Decision Forest package has been used to insert the updated tree into a real model, so that the model can be used for predicting and updating the placeholders.</p><p>Firstly, the orignal model's signature has been copied, and will be used in the builder to make sure that the new model handles the data types correctly, more context of this purpose can be found in the <a href="https://github.com/tensorflow/decision-forests/issues/184?ref=localhost#issuecomment-1617746591">conversation with the TensorFlow Decision Forest author</a>.</p><pre><code class="language-py">def copy_model_sig(model):
  """
  Copy the model signature to a new model.

  Parameters
  -----------
    model: a native model built by tfdf.keras.

  Return
  -----------
    A copy of the original model's signature.
  """
  spec = model.save_spec()[0][0]
  return lambda insp: spec
</code></pre><pre><code class="language-py">classes = ["Adelie", "Gentoo" , "Chinstrap"]
classes.sort()

# Create the model builder

model_trial_idx = 0

model_trial_idx += 1
model_path = f"/tmp/manual_model/{model_trial_idx}"


!rm -rf /tmp/manual_model

builder = tfdf.builder.CARTBuilder(
    path=model_path,
    objective=tfdf.py_tree.objective.ClassificationObjective(
        label="species", classes=classes),
    input_signature_example_fn=copy_model_sig(model)
)
</code></pre><p>Then add the tree and conclude the building process:</p><pre><code class="language-py">builder.add_tree(sample_tree)
builder.close()
</code></pre><h3 id="26-activate-the-fusion-model">2.6 Activate the Fusion Model</h3><p>Like stated earlier, the builder is able to create a regular Keras model for prediction, so let's active this.</p><pre><code class="language-py">fusion_model = tf.keras.models.load_model(model_path)

pred_value = fusion_model.predict(dataset_tf)
pred_value[:5]
</code></pre><p>The output is like:</p><pre><code>array([[0.  , 0.  , 0.02],
       [0.  , 0.  , 0.02],
       [0.  , 0.  , 0.02],
       [0.  , 0.  , 0.02],
       [0.  , 0.  , 0.02]], dtype=float32)
</code></pre><p>The leaf assignment can be calculated by multiplying the prediction values with the scale divisor.</p><pre><code class="language-py">dataset_df['leaf_idx'] = pred_value[:,2]*scale_div
dataset_df
</code></pre><p>The output is like:</p><!--kg-card-begin: html--><table>
<thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right">species</th>
<th style="text-align: right">island</th>
<th style="text-align: right">bill_length_mm</th>
<th style="text-align: right">bill_depth_mm</th>
<th style="text-align: right">flipper_length_mm</th>
<th style="text-align: right">body_mass_g</th>
<th style="text-align: right">sex</th>
<th style="text-align: right">year</th>
<th style="text-align: right">leaf_idx</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right">0</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">39.1</td>
<td style="text-align: right">18.7</td>
<td style="text-align: right">181.0</td>
<td style="text-align: right">3750.0</td>
<td style="text-align: right">male</td>
<td style="text-align: right">2007</td>
<td style="text-align: right">2.0</td>
</tr>
<tr>
<td style="text-align: right">1</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">39.5</td>
<td style="text-align: right">17.4</td>
<td style="text-align: right">186.0</td>
<td style="text-align: right">3800.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2007</td>
<td style="text-align: right">2.0</td>
</tr>
<tr>
<td style="text-align: right">2</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">40.3</td>
<td style="text-align: right">18.0</td>
<td style="text-align: right">195.0</td>
<td style="text-align: right">3250.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2007</td>
<td style="text-align: right">2.0</td>
</tr>
<tr>
<td style="text-align: right">3</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">NaN</td>
<td style="text-align: right">2007</td>
<td style="text-align: right">2.0</td>
</tr>
<tr>
<td style="text-align: right">4</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">Torgersen</td>
<td style="text-align: right">36.7</td>
<td style="text-align: right">19.3</td>
<td style="text-align: right">193.0</td>
<td style="text-align: right">3450.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2007</td>
<td style="text-align: right">2.0</td>
</tr>
<tr>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
<td style="text-align: right">...</td>
</tr>
<tr>
<td style="text-align: right">339</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">55.8</td>
<td style="text-align: right">19.8</td>
<td style="text-align: right">207.0</td>
<td style="text-align: right">4000.0</td>
<td style="text-align: right">male</td>
<td style="text-align: right">2009</td>
<td style="text-align: right">4.0</td>
</tr>
<tr>
<td style="text-align: right">340</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">43.5</td>
<td style="text-align: right">18.1</td>
<td style="text-align: right">202.0</td>
<td style="text-align: right">3400.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2009</td>
<td style="text-align: right">1.0</td>
</tr>
<tr>
<td style="text-align: right">341</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">49.6</td>
<td style="text-align: right">18.2</td>
<td style="text-align: right">193.0</td>
<td style="text-align: right">3775.0</td>
<td style="text-align: right">male</td>
<td style="text-align: right">2009</td>
<td style="text-align: right">1.0</td>
</tr>
<tr>
<td style="text-align: right">342</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">50.8</td>
<td style="text-align: right">19.0</td>
<td style="text-align: right">210.0</td>
<td style="text-align: right">4100.0</td>
<td style="text-align: right">male</td>
<td style="text-align: right">2009</td>
<td style="text-align: right">4.0</td>
</tr>
<tr>
<td style="text-align: right">343</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">Dream</td>
<td style="text-align: right">50.2</td>
<td style="text-align: right">18.7</td>
<td style="text-align: right">198.0</td>
<td style="text-align: right">3775.0</td>
<td style="text-align: right">female</td>
<td style="text-align: right">2009</td>
<td style="text-align: right">1.0</td>
</tr>
</tbody>
</table><!--kg-card-end: html--><p>Next, let's calculate the probability and number of samples of each leaf.</p><pre><code class="language-py">leaf_num_samples = dataset_df.groupby('leaf_idx').agg(total_samples=('species','count')).reset_index()

node_prob_res = dataset_df.groupby(['leaf_idx','species']).agg(num_samples=('species','count')).unstack().stack(dropna=False).reset_index().fillna(0)

node_prob_res = node_prob_res.merge(leaf_num_samples, on='leaf_idx', how='left')

node_prob_res['prob'] = node_prob_res['num_samples']/node_prob_res['total_samples']

node_prob_array = node_prob_res.groupby('leaf_idx')['prob'].apply(list)

node_prob_res
</code></pre><!--kg-card-begin: html--><table>
<thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: right">leaf_idx</th>
<th style="text-align: right">species</th>
<th style="text-align: right">num_samples</th>
<th style="text-align: right">total_samples</th>
<th style="text-align: right">prob</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right">0</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">53.0</td>
<td style="text-align: right">54</td>
<td style="text-align: right">0.981481</td>
</tr>
<tr>
<td style="text-align: right">1</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">1.0</td>
<td style="text-align: right">54</td>
<td style="text-align: right">0.018519</td>
</tr>
<tr>
<td style="text-align: right">2</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">Gentoo</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">54</td>
<td style="text-align: right">0.000000</td>
</tr>
<tr>
<td style="text-align: right">3</td>
<td style="text-align: right">1.0</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">2.0</td>
<td style="text-align: right">64</td>
<td style="text-align: right">0.031250</td>
</tr>
<tr>
<td style="text-align: right">4</td>
<td style="text-align: right">1.0</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">62.0</td>
<td style="text-align: right">64</td>
<td style="text-align: right">0.968750</td>
</tr>
<tr>
<td style="text-align: right">5</td>
<td style="text-align: right">1.0</td>
<td style="text-align: right">Gentoo</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">64</td>
<td style="text-align: right">0.000000</td>
</tr>
<tr>
<td style="text-align: right">6</td>
<td style="text-align: right">2.0</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">95.0</td>
<td style="text-align: right">97</td>
<td style="text-align: right">0.979381</td>
</tr>
<tr>
<td style="text-align: right">7</td>
<td style="text-align: right">2.0</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">97</td>
<td style="text-align: right">0.000000</td>
</tr>
<tr>
<td style="text-align: right">8</td>
<td style="text-align: right">2.0</td>
<td style="text-align: right">Gentoo</td>
<td style="text-align: right">2.0</td>
<td style="text-align: right">97</td>
<td style="text-align: right">0.020619</td>
</tr>
<tr>
<td style="text-align: right">9</td>
<td style="text-align: right">3.0</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">122</td>
<td style="text-align: right">0.000000</td>
</tr>
<tr>
<td style="text-align: right">10</td>
<td style="text-align: right">3.0</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">122</td>
<td style="text-align: right">0.000000</td>
</tr>
<tr>
<td style="text-align: right">11</td>
<td style="text-align: right">3.0</td>
<td style="text-align: right">Gentoo</td>
<td style="text-align: right">122.0</td>
<td style="text-align: right">122</td>
<td style="text-align: right">1.000000</td>
</tr>
<tr>
<td style="text-align: right">12</td>
<td style="text-align: right">4.0</td>
<td style="text-align: right">Adelie</td>
<td style="text-align: right">2.0</td>
<td style="text-align: right">7</td>
<td style="text-align: right">0.285714</td>
</tr>
<tr>
<td style="text-align: right">13</td>
<td style="text-align: right">4.0</td>
<td style="text-align: right">Chinstrap</td>
<td style="text-align: right">5.0</td>
<td style="text-align: right">7</td>
<td style="text-align: right">0.714286</td>
</tr>
<tr>
<td style="text-align: right">14</td>
<td style="text-align: right">4.0</td>
<td style="text-align: right">Gentoo</td>
<td style="text-align: right">0.0</td>
<td style="text-align: right">7</td>
<td style="text-align: right">0.000000</td>
</tr>
</tbody>
</table><!--kg-card-end: html--><h3 id="27-refresh-the-fusion-model">2.7 Refresh the Fusion Model</h3><p>Now that the literal performance of each nodes has been calculated, these results can be used to update the fusion model.</p><pre><code class="language-py">def leaf_res_refresh(root, probs, num_samples):
    """
    Reset the probability values of each leaf node.

    Parameters
    -----------
      root: root node of a tree.
      probs: an array of probability of each class, for each node 
      num_samples: number of example in the node.

    Return
    -----------
      A tree structure with literal probability and number of samples for each leaf node.
    """

    import tensorflow_decision_forests as tfdf

    # Alias
    LeafNode = tfdf.py_tree.node.LeafNode
    ProbabilityValue = tfdf.py_tree.value.ProbabilityValue

    if root is None:
        return

    if isinstance(root, LeafNode):

        root.value = ProbabilityValue(probability=probs[root.leaf_idx], num_examples=num_samples[root.leaf_idx])
    else:
        leaf_res_refresh(root.pos_child, probs, num_samples)
        leaf_res_refresh(root.neg_child, probs, num_samples)

    return


leaf_res_refresh(root=sample_tree.root,
                probs=node_prob_array,
                num_samples=leaf_num_samples['total_samples'])
                
print(sample_tree)                
</code></pre><p>Then the tree has been updated:</p><pre><code class="language-shell">(flipper_length_mm &gt;= 206.5; miss=False, score=0.5436033606529236)
    â”œâ”€(pos)â”€ (bill_depth_mm &gt;= 17.5; miss=False, score=None)
    â”‚        â”œâ”€(pos)â”€ ProbabilityValue([0.2857142857142857, 0.7142857142857143, 0.0],n=7) (idx=4)
    â”‚        â””â”€(neg)â”€ ProbabilityValue([0.0, 0.0, 1.0],n=122) (idx=3)
    â””â”€(neg)â”€ (island in ['Biscoe', 'Torgersen']; miss=True, score=0.23399487137794495)
             â”œâ”€(pos)â”€ ProbabilityValue([0.979381443298969, 0.0, 0.020618556701030927],n=97) (idx=2)
             â””â”€(neg)â”€ (bill_length_mm &gt;= 42.349998474121094; miss=True, score=0.5646106004714966)
                      â”œâ”€(pos)â”€ ProbabilityValue([0.03125, 0.96875, 0.0],n=64) (idx=1)
                      â””â”€(neg)â”€ ProbabilityValue([0.9814814814814815, 0.018518518518518517, 0.0],n=54) (idx=0)
</code></pre><p>Let's visualize the fusion model:</p><pre><code class="language-py">new_model_trial_idx = 2

new_model_trial_idx += 1
new_model_path = f"/tmp/manual_model/{new_model_trial_idx}"


!rm -rf /tmp/manual_model

new_builder = tfdf.builder.CARTBuilder(
    path=new_model_path,
    objective=tfdf.py_tree.objective.ClassificationObjective(
        label="species", classes=classes),
    input_signature_example_fn=copy_model_sig(model)
)

new_builder.add_tree(sample_tree)
new_builder.close()

new_fusion_model = tf.keras.models.load_model(new_model_path)

tfdf.model_plotter.plot_model_in_colab(new_fusion_model)</code></pre><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://cdn.jsdelivr.net/gh/BulletTech2021/Pics/img/1_V/fusion_tre.png" class="kg-image" alt loading="lazy"><figcaption>Updated Decision Tree</figcaption></figure><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">ðŸ’¡</div><div class="kg-callout-text">The non-leaf nodes performance cannot be updated because the TensorFlow Decision Forest does not provide proper setter methods.</div></div><h3 id="28-extract-the-tree-rules">2.8 Extract the Tree Rules</h3><p>Last step is to extract the rules of the tree so that these rules can be further fine-tuned by hand or used for deployment.</p><pre><code class="language-python">def get_tree_path(node):

  """
  Parse a binary tree to get all decision paths.

  Parameters:
  -----------
    node: root node of the tree structure to traverse.
  
  Return:
  -----------
    All decision path from root to each leaf node.
  """

  
  import tensorflow_decision_forests as tfdf

  # Alias
  LeafNode = tfdf.py_tree.node.LeafNode
  CategoricalIsInCondition = tfdf.py_tree.condition.CategoricalIsInCondition

  paths = []
  path = []

  def recurse_(node, path, paths):

    if not isinstance(node, LeafNode):

      # Categorical features
      if isinstance(node.condition, CategoricalIsInCondition):
        name = node.condition.feature.name
        p1, p2 = list(path), list(path)
        p1 += [f"({name} in {str(node.condition.mask)})"]
        recurse_(node.neg_child, p1, paths)
        p2 += [f"({name} not in {str(node.condition.mask)})"]
        recurse_(node.pos_child, p2, paths)
      
      # Numerical features
      else:
        name = node.condition.feature.name
        threshold = float(node.condition.threshold)
        p1, p2 = list(path), list(path)
        p1 += [f"({name} &lt; {threshold})"]
        recurse_(node.neg_child, p1, paths)
        p2 += [f"({name} &gt;= {threshold})"]
        recurse_(node.pos_child, p2, paths)
    else:
      path += [(node.value.probability, node.value.num_examples, node.leaf_idx)]
      paths += [path]
  
  recurse_(node=node, 
           path=path, 
           paths=paths)
  
  rule_dict = {}

  # Format the results
  for path in paths:
    rule_path = []
    num_samples = path[-1][1]
    leaf_idx = path[-1][-1]
    for p in path[:-1]:
      rule_path.append(str(p))
    leaf_probability = path[-1][0]

    rule_result = [rule_path, leaf_probability, num_samples]
    rule_dict[leaf_idx] = rule_result
  
  return rule_dict</code></pre><pre><code class="language-python">rule_res = get_tree_path(sample_tree.root)</code></pre><p>When this function is called, it returns a dictionary <code>{leaf index: [rules, probability, number of samples]}</code>.</p><pre><code class="language-python">{0: [['(flipper_length_mm &lt; 206.5)',
   "(island in ['Biscoe', 'Torgersen'])",
   '(bill_length_mm &lt; 42.349998474121094)'],
  [0.9814814814814815, 0.018518518518518517, 0.0],
  54],
 1: [['(flipper_length_mm &lt; 206.5)',
   "(island in ['Biscoe', 'Torgersen'])",
   '(bill_length_mm &gt;= 42.349998474121094)'],
  [0.03125, 0.96875, 0.0],
  64],
 2: [['(flipper_length_mm &lt; 206.5)',
   "(island not in ['Biscoe', 'Torgersen'])"],
  [0.979381443298969, 0.0, 0.020618556701030927],
  97],
 3: [['(flipper_length_mm &gt;= 206.5)', '(bill_depth_mm &lt; 17.5)'],
  [0.0, 0.0, 1.0],
  122],
 4: [['(flipper_length_mm &gt;= 206.5)', '(bill_depth_mm &gt;= 17.5)'],
  [0.2857142857142857, 0.7142857142857143, 0.0],
  7]}</code></pre><h2 id="3-conclusion">3 Conclusion</h2><p>As you can see, by utilizing TensorFlow Decision Forest builder along with custom traversal functions, you are able to </p><ul><li>Fusion your human expertise with native decision tree.</li><li>Get the performance of your fusion model.</li><li>Extract the decision rules programatically.</li></ul><p>This solution is helpful for many data scientists who need to build rule-based business strategies which are mostly required to intuitive, compliant with laws and regulations. </p><p>The complete Colab notebook can be found below:</p><figure class="kg-card kg-bookmark-card kg-card-hascaption"><a class="kg-bookmark-container" href="https://colab.research.google.com/drive/18CXkwQphPtybxjbW19lBRLcqBWAu0j86?usp=sharing&ref=localhost"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Google Colaboratory</div><div class="kg-bookmark-description"></div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://ssl.gstatic.com/colaboratory-static/common/ab120b27e337cb836e61fbe14949ef05/img/favicon.ico" alt=""></div></div><div class="kg-bookmark-thumbnail"><img src="https://colab.research.google.com/img/colab_favicon_256px.png" alt=""></div></a><figcaption>Build Decision Tree by Hand</figcaption></figure><p>Hopefully it helps.</p>
        </section>

    </article>

        <div class="gh-comments gh-canvas">
            
        <script defer src="https://cdn.jsdelivr.net/ghost/comments-ui@~0.17/umd/comments-ui.min.js" data-ghost-comments="https://realvincentyuan.github.io/Spacecraft/" data-api="https://realvincentyuan.github.io/Spacecraft/ghost/api/content/" data-admin="https://realvincentyuan.github.io/Spacecraft/ghost/" data-key="59658b4dc0364cacbc3332171d" data-title="null" data-count="true" data-post-id="668a1b22ac15d470add4a2cd" data-color-scheme="auto" data-avatar-saturation="60" data-accent-color="#0f69c2" data-comments-enabled="all" data-publication="Spacecraft" crossorigin="anonymous"></script>
    
        </div>

</main>


            <section class="gh-container is-grid gh-outer">
                <div class="gh-container-inner gh-inner">
                    <h2 class="gh-container-title">Read more</h2>
                    <div class="gh-feed">
                            <article class="gh-card post featured">
    <a class="gh-card-link" href="../how-to-prompt-correctly-with-llama-2/index.html">
            <figure class="gh-card-image">
                <img
                    srcset="https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;160 160w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;320 320w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;600 600w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;960 960w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;1200 1200w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;2000 2000w"
                    sizes="320px"
                    src="https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;600"
                    alt="How to Prompt Correctly with Llama 2?"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">How to Prompt Correctly with Llama 2?</h3>
                <p class="gh-card-excerpt is-body">Some learnings with prompting to Llama 2.</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By Vincent Yuan</span>
                    <time class="gh-card-date" datetime="2024-01-27">Jan 27, 2024</time>
                <!--
         --></footer>
        </div>
    </a>
</article>                            <article class="gh-card post featured">
    <a class="gh-card-link" href="../build-a-fraud-intelligence-analyst-powered-by-llama-2-in-google-colab-with-gpus/index.html">
            <figure class="gh-card-image">
                <img
                    srcset="https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;160 160w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;320 320w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;600 600w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;960 960w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;1200 1200w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;2000 2000w"
                    sizes="320px"
                    src="https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;600"
                    alt="Build a Fraud Intelligence Analyst Powered by Llama 2 in Google Colab with GPUs"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">Build a Fraud Intelligence Analyst Powered by Llama 2 in Google Colab with GPUs</h3>
                <p class="gh-card-excerpt is-body">Let Llama 2 help credit card fraud detection!
</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By Vincent Yuan</span>
                    <time class="gh-card-date" datetime="2024-01-12">Jan 12, 2024</time>
                <!--
         --></footer>
        </div>
    </a>
</article>                            <article class="gh-card post featured">
    <a class="gh-card-link" href="../run-llama-2-with-retrieval-augmented-generation-rag-in-google-colab-with-gpus/index.html">
            <figure class="gh-card-image">
                <img
                    srcset="https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;160 160w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;320 320w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;600 600w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;960 960w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;1200 1200w,
                            https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;2000 2000w"
                    sizes="320px"
                    src="https://images.unsplash.com/photo-1703693220150-422c569bb33e?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDEyNHx8dnkxMjE4fGVufDB8fHx8MTcwNjQxNjI4OXww&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;600"
                    alt="Run Llama 2 with Retrieval Augmented Generation in Google Colab with GPUs"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">Run Llama 2 with Retrieval Augmented Generation in Google Colab with GPUs</h3>
                <p class="gh-card-excerpt is-body">Run Llama 2 with RAG in Google Colab.
</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By Vincent Yuan</span>
                    <time class="gh-card-date" datetime="2024-01-07">Jan 7, 2024</time>
                <!--
         --></footer>
        </div>
    </a>
</article>                            <article class="gh-card post featured">
    <a class="gh-card-link" href="../say-hello-to-2024/index.html">
            <figure class="gh-card-image">
                <img
                    srcset="https://images.unsplash.com/photo-1694140067948-0a015a055ce3?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDE2fHx2eTEyMTh8ZW58MHx8fHwxNzA0MDM5OTA0fDA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;160 160w,
                            https://images.unsplash.com/photo-1694140067948-0a015a055ce3?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDE2fHx2eTEyMTh8ZW58MHx8fHwxNzA0MDM5OTA0fDA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;320 320w,
                            https://images.unsplash.com/photo-1694140067948-0a015a055ce3?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDE2fHx2eTEyMTh8ZW58MHx8fHwxNzA0MDM5OTA0fDA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;600 600w,
                            https://images.unsplash.com/photo-1694140067948-0a015a055ce3?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDE2fHx2eTEyMTh8ZW58MHx8fHwxNzA0MDM5OTA0fDA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;960 960w,
                            https://images.unsplash.com/photo-1694140067948-0a015a055ce3?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDE2fHx2eTEyMTh8ZW58MHx8fHwxNzA0MDM5OTA0fDA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;1200 1200w,
                            https://images.unsplash.com/photo-1694140067948-0a015a055ce3?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;webp&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDE2fHx2eTEyMTh8ZW58MHx8fHwxNzA0MDM5OTA0fDA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;2000 2000w"
                    sizes="320px"
                    src="https://images.unsplash.com/photo-1694140067948-0a015a055ce3?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDE2fHx2eTEyMTh8ZW58MHx8fHwxNzA0MDM5OTA0fDA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;600"
                    alt="Say Hello to 2024"
                    loading="lazy"
                >
            </figure>
        <div class="gh-card-wrapper">
            <h3 class="gh-card-title is-title">Say Hello to 2024</h3>
                <p class="gh-card-excerpt is-body">Reflecting on 2023 and looking ahead to 2024.</p>
            <footer class="gh-card-meta">
<!--
             -->
                    <span class="gh-card-author">By Vincent Yuan</span>
                    <time class="gh-card-date" datetime="2023-12-31">Dec 31, 2023</time>
                <!--
         --></footer>
        </div>
    </a>
</article>                    </div>
                </div>
            </section>

    
    <footer class="gh-footer gh-outer">
    <div class="gh-footer-inner gh-inner">

        <div class="gh-footer-bar">
            <span class="gh-footer-logo is-title">
                    Spacecraft
            </span>
            <nav class="gh-footer-menu">
                <ul class="nav">
    <li class="nav-sign-up"><a href="index.html#/portal/">Sign up</a></li>
</ul>

            </nav>
            <div class="gh-footer-copyright">
                Powered by <a href="https://ghost.org/" target="_blank" rel="noopener">Ghost</a>
            </div>
        </div>

                <section class="gh-footer-signup">
                    <h2 class="gh-footer-signup-header is-title">
                        Spacecraft
                    </h2>
                    <p class="gh-footer-signup-subhead is-body">
                        Healthy food for thoughts about this beautiful life!
                    </p>
                    <form class="gh-form" data-members-form>
    <input class="gh-form-input" id="footer-email" name="email" type="email" placeholder="jamie@example.com" required data-members-email>
    <button class="gh-button" type="submit" aria-label="Subscribe">
        <span><span>Subscribe</span> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 256 256"><path d="M224.49,136.49l-72,72a12,12,0,0,1-17-17L187,140H40a12,12,0,0,1,0-24H187L135.51,64.48a12,12,0,0,1,17-17l72,72A12,12,0,0,1,224.49,136.49Z"></path></svg></span>
        <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24">
    <g stroke-linecap="round" stroke-width="2" fill="currentColor" stroke="none" stroke-linejoin="round" class="nc-icon-wrapper">
        <g class="nc-loop-dots-4-24-icon-o">
            <circle cx="4" cy="12" r="3"></circle>
            <circle cx="12" cy="12" r="3"></circle>
            <circle cx="20" cy="12" r="3"></circle>
        </g>
        <style data-cap="butt">
            .nc-loop-dots-4-24-icon-o{--animation-duration:0.8s}
            .nc-loop-dots-4-24-icon-o *{opacity:.4;transform:scale(.75);animation:nc-loop-dots-4-anim var(--animation-duration) infinite}
            .nc-loop-dots-4-24-icon-o :nth-child(1){transform-origin:4px 12px;animation-delay:-.3s;animation-delay:calc(var(--animation-duration)/-2.666)}
            .nc-loop-dots-4-24-icon-o :nth-child(2){transform-origin:12px 12px;animation-delay:-.15s;animation-delay:calc(var(--animation-duration)/-5.333)}
            .nc-loop-dots-4-24-icon-o :nth-child(3){transform-origin:20px 12px}
            @keyframes nc-loop-dots-4-anim{0%,100%{opacity:.4;transform:scale(.75)}50%{opacity:1;transform:scale(1)}}
        </style>
    </g>
</svg>        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
    <style>
        .checkmark {
            width: 40px;
            height: 40px;
            display: block;
            stroke-width: 2.5;
            stroke: currentColor;
            stroke-miterlimit: 10;
        }

        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke .3s cubic-bezier(0.650, 0.000, 0.450, 1.000) forwards;
        }

        @keyframes stroke {
            100% { stroke-dashoffset: 0; }
        }
    </style>
</svg>    </button>
    <p data-members-error></p>
</form>                </section>

    </div>
</footer>    
</div>

    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>

    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/built/source.js%3Fv=9b52753ec9"></script>

<!-- Code highlights -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js" integrity="sha512-9khQRAUBYEJDCDVP2yw3LRUQvjJ0Pjx0EShmaQjcHa6AXiOv6qHQu9lCAIR8O+/D8FtaCoJ2c0Tf9Xo7hYH01Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-fTl/qcO1VgvKtOMApX2PdZzkziyr2stM65GYPLGuYMnuMm1z2JLJG6XVU7C/mR+E7xBUqCivykuhlzfqxXBXbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<!--   Scroll Top Button  -->
<script>
const scrollTopBtn = document.querySelector('.js-scroll-top');
if (scrollTopBtn) {
  scrollTopBtn.onclick = () => {
    window.scrollTo({top: 0, behavior: 'smooth'});
  }
  
  const progressPath = document.querySelector('.scroll-top path');
  const pathLength = progressPath.getTotalLength();
  progressPath.style.transition = progressPath.style.WebkitTransition = 'none';
  progressPath.style.strokeDasharray = `${pathLength} ${pathLength}`;
  progressPath.style.strokeDashoffset = pathLength;
  progressPath.getBoundingClientRect();
  progressPath.style.transition = progressPath.style.WebkitTransition = 'stroke-dashoffset 10ms linear';		
  const updateProgress = function() {
    const scroll = window.scrollY || window.scrollTopBtn || document.documentElement.scrollTopBtn;

    const docHeight = Math.max(
      document.body.scrollHeight, document.documentElement.scrollHeight,
      document.body.offsetHeight, document.documentElement.offsetHeight,
      document.body.clientHeight, document.documentElement.clientHeight
    );

    const windowHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

    const height = docHeight - windowHeight;
    var progress = pathLength - (scroll * pathLength / height);
    progressPath.style.strokeDashoffset = progress;
  }

  updateProgress();
  const offset = 100;

  window.addEventListener('scroll', function(event) {
    updateProgress();

    //Scroll back to top
    const scrollPos = window.scrollY || window.scrollTopBtn || document.getElementsByTagName('html')[0].scrollTopBtn;
    scrollPos > offset ? scrollTopBtn.classList.add('is-active') : scrollTopBtn.classList.remove('is-active');

  }, false);
}
</script>

</body>
</html>
